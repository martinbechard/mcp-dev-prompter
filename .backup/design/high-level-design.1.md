<!--
Copyright (c) 2024 Martin Bechard <martin.bechard@DevConsult.ca>
This software is licensed under the MIT License.
File: /Users/martinbechard/dev/mcp-dev-prompter/design/high-level-design.md
This was generated by Claude Sonnet 3.5, with the assistance of my human mentor

High-level design document for the Dev Prompter Server
Overview: Making development easier with AI-powered prompting assistance!
-->

# High-Level Design

## System Overview

The Dev Prompter Server provides development assistance through structured prompting. It implements the Model Context Protocol (MCP) using the @modelcontextprotocol/sdk package to offer a set of carefully crafted prompts for common development tasks.

## Required Files

| File                 | Purpose                                          |
| -------------------- | ------------------------------------------------ |
| Build.md             | Build settings and scripts                       |
| Constants.md         | System-wide constants including prompt templates |
| DevPrompterServer.md | Main server implementation design                |
| Index.md             | Project documentation and entry point            |
| Logger.md            | Logging system design                            |
| PromptConfig.md      | Prompt configuration types and settings          |
| PromptTypes.md       | Type definitions for prompts and responses       |
| PromptValidator.md   | Validation logic for prompt inputs               |
| StdioServer.md       | MCP communication implementation                 |
| class-diagram.mmd    | System component relationships                   |
| server-init-flow.mmd | Server initialization flow                       |

## Core Components

1. MCP Server Integration

   - Uses @modelcontextprotocol/sdk for MCP implementation
   - StdioServerTransport for communication with Claude
   - Full MCP prompt protocol support
   - Reserves stdout for protocol messages only
   - All logging and debug output directed to stderr

2. Prompting System

   - Four core prompt types:
     a. High-level design generation
     b. Detailed module design
     c. Code implementation
     d. Test suite creation
   - Structured prompt templates
   - Context-aware prompt generation

3. Validation & Type Safety

   - Uses Zod for runtime validation
   - TypeScript types for compile-time safety
   - Validates prompt inputs and arguments

4. Logging System
   - File and console logging via stderr
   - Timestamps on all entries
   - Debug support
   - Preserves stdout for protocol messages only

## Protocol Implementation

1. MCP Prompts
   - high-level-design: System architecture
   - detailed-design: Module specifications
   - generate-code: Implementation code
   - generate-tests: Test suites
   - Proper schema definitions
   - Error handling per MCP spec

## Security Considerations

1. Configuration Management

   - Environment variables
   - Command line arguments
   - Never logged or exposed

2. Error Handling

   - Safe error messages
   - No sensitive data in logs
   - Proper cleanup on exit

3. Input Validation
   - All inputs validated
   - Size limits enforced
   - Type checking

## Performance Considerations

1. Response Time

   - Efficient prompt processing
   - Proper timeout handling
   - Async operations

2. Resource Usage
   - Memory efficient logging
   - Template caching
   - Proper cleanup

## Testing Strategy

1. Unit Tests

   - Component isolation
   - Input validation
   - Error handling

2. Integration Tests

   - End-to-end flows
   - Prompt generation
   - Protocol compliance

3. Performance Tests
   - Response times
   - Memory usage
   - Load handling

## Development Guidelines

1. Code Organization

   - Clear separation of concerns
   - Modular design
   - Type-first approach

2. Error Handling

   - Comprehensive error types
   - Proper error propagation
   - Informative messages

3. Logging
   - Consistent format
   - Appropriate detail level
   - Performance impact considered
   - All output to stderr except protocol messages
   - stdout reserved for MCP protocol communication

## Implementation Phases

1. Phase 1: Core Framework

   - Basic server setup
   - MCP integration
   - Logging system

2. Phase 2: Prompt System

   - High-level design prompts
   - Detailed design prompts
   - Template engine

3. Phase 3: Code Generation

   - Implementation prompts
   - Test generation prompts
   - Context handling

4. Phase 4: Refinement
   - Performance optimization
   - Enhanced error handling
   - Documentation
