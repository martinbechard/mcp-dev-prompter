<!--
Copyright (c) 2024 Martin Bechard <martin.bechard@DevConsult.ca>
This software is licensed under the MIT License.
File: /Users/martinbechard/dev/mcp-dev-prompter/design/PromptTypes.md
This was generated by Claude Sonnet 3.5, with the assistance of my human mentor

Design document for prompt-related type definitions
Types: Because TypeScript makes templates safer!
-->

# Table of Contents
- Type: MCP Registration Types
- Type: Template Processing Types
- Type: Runtime Types
- Type: Error Types

---
# Type: MCP Registration Types

## Overview
Types used to register prompts with the MCP protocol.

## Design Requirements
1. MUST match MCP prompt registration schema
2. MUST support all prompt metadata
3. MUST handle argument definitions

## Attributes
```typescript
/**
 * MCP prompt registration metadata
 */
type PromptRegistration = {
    /** Prompt identifier (from template filename) */
    name: string;

    /** Human-readable description */
    description: string;

    /** Prompt arguments */
    arguments: PromptArgument[];
};

/**
 * MCP argument definition
 */
type PromptArgument = {
    /** Argument identifier */
    name: string;

    /** Human-readable description */
    description: string;

    /** Whether argument must be provided */
    required: boolean;
};
```

# Type: Template Processing Types

## Overview
Types used during template loading and processing.

## Design Requirements
1. MUST capture all template metadata
2. MUST support variable analysis
3. MUST enable safe template processing

## Attributes
```typescript
/**
 * Template metadata from front matter
 */
type TemplateMetadata = {
    /** Human-readable description */
    description: string;

    /** Template version */
    version: string;

    /** Template arguments */
    arguments: Record<string, TemplateArgument>;
};

/**
 * Template argument definition
 */
type TemplateArgument = {
    /** Human-readable description */
    description: string;

    /** Override for template analysis */
    required?: boolean;
};

/**
 * Processed template ready for rendering
 */
type PromptTemplate = {
    /** Template identifier */
    id: string;

    /** Template metadata */
    metadata: TemplateMetadata;

    /** Template content */
    content: string;

    /** Analyzed arguments */
    arguments: {
        name: string;
        description: string;
        required: boolean;
        usageType: 'direct' | 'conditional';
    }[];
};
```

# Type: Runtime Types

## Overview
Types used during prompt execution.

## Design Requirements
1. MUST support all prompt parameters
2. MUST handle execution context
3. MUST enable type-safe responses

## Attributes
```typescript
/**
 * Incoming prompt request
 */
type PromptRequest = {
    /** Template identifier */
    templateId: string;

    /** Argument values */
    arguments: Record<string, unknown>;

    /** Optional execution context */
    context?: PromptContext;
};

/**
 * Generated prompt response
 */
type PromptResponse = {
    /** Generated prompt text */
    content: string;

    /** Template used */
    template: PromptTemplate;

    /** Arguments applied */
    appliedArguments: Record<string, unknown>;
};

/**
 * Execution context
 */
type PromptContext = {
    /** Maximum prompt length */
    maxLength?: number;

    /** Processing options */
    options?: {
        /** Whether to trim whitespace */
        trimWhitespace?: boolean;

        /** Line ending style */
        lineEndings?: 'lf' | 'crlf';
    };
};
```

# Type: Error Types

## Overview
Error types for prompt processing.

## Design Requirements
1. MUST provide clear error context
2. MUST support error hierarchies
3. MUST enable specific handling

## Attributes
```typescript
/**
 * Base prompt error
 */
class PromptError extends Error {
    constructor(
        message: string,
        public readonly templateId: string,
        public readonly details?: unknown
    ) {
        super(`Prompt error for ${templateId}: ${message}`);
    }
}

/**
 * Argument validation error
 */
class ValidationError extends PromptError {
    constructor(
        templateId: string,
        public readonly argument: string,
        public readonly value: unknown,
        public readonly reason: string
    ) {
        super(
            `Invalid argument "${argument}": ${reason}`,
            templateId,
            { argument, value }
        );
    }
}

/**
 * Template processing error
 */
class TemplateError extends PromptError {
    constructor(
        templateId: string,
        public readonly phase: 'loading' | 'parsing' | 'rendering',
        public readonly reason: string
    ) {
        super(
            `Template error during ${phase}: ${reason}`,
            templateId
        );
    }
}
```

## Usage Example

```typescript
// Register prompt with MCP
const registration: PromptRegistration = {
    name: 'high-level-design',
    description: template.metadata.description,
    arguments: template.arguments.map(arg => ({
        name: arg.name,
        description: arg.description,
        required: arg.required
    }))
};

// Process prompt request
try {
    const request: PromptRequest = {
        templateId: 'high-level-design',
        arguments: {
            projectName: 'MyProject',
            purpose: 'Main purpose'
        },
        context: {
            maxLength: 2000,
            options: {
                trimWhitespace: true
            }
        }
    };
    
    const response: PromptResponse = await processPrompt(request);
    console.log('Generated prompt:', response.content);
    
} catch (error) {
    if (error instanceof ValidationError) {
        console.error(`Invalid argument: ${error.argument}`);
    } else if (error instanceof TemplateError) {
        console.error(`Template error: ${error.reason}`);
    }
}
```